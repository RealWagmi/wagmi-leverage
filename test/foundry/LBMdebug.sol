// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.10;

import "forge-std/Test.sol";

import { LiquidityBorrowingManager } from "contracts/LiquidityBorrowingManager.sol";
import { HelperContract } from "../testsHelpers/HelperContract.sol";
import { IApproveSwapAndPay, ILiquidityBorrowingManager } from "contracts/interfaces/ILiquidityBorrowingManager.sol";
import { console } from "forge-std/console.sol";

contract LBMdebug is Test, HelperContract {
    address constant NONFUNGIBLE_POSITION_MANAGER_ADDRESS =
        0xA7E119Cf6c8f5Be29Ca82611752463f0fFcb1B02;
    address constant UNISWAP_V3_FACTORY = 0x8112E18a34b63964388a3B2984037d6a2EFE5B8A;
    bytes32 constant UNISWAP_V3_POOL_INIT_CODE_HASH =
        0x30146866f3a846fe3c636beb2756dbd24cf321bc52c9113c837c21f47470dfeb;
    LiquidityBorrowingManager constant lbm =
        LiquidityBorrowingManager(0x20fa274D00fF4917A13cD464FDbB200475B6EaBd);
    address constant alice = 0xF00c8aE29f49173C976e0926aaB71931cd646cFA;
    address constant POOL = 0x28D5576057A27F95d5dB75776BA50e6e84FAf477;
    address constant WMETIS = 0x75cb093E4D61d2A2e65D8e0BBb01DE8d89b53481;
    address constant WAGMI = 0xaf20f5f19698f1D19351028cd7103B63D30DE7d7;

    function setUp() public {
        vm.createSelectFork("metis", 14674550);
        vm.label(address(this), "ChartDebug");
        vm.label(address(NONFUNGIBLE_POSITION_MANAGER_ADDRESS), "NONFUNGIBLE_POSITION_MANAGER");
        vm.label(address(lbm), "LiquidityBorrowingManager");
        vm.label(alice, "Alice");
        vm.label(lbm.VAULT_ADDRESS(), "Vault");
        vm.label(POOL, "WMETIS/WAGMI UNI-V3 Pool");
        vm.label(WMETIS, "WMETIS");
        vm.label(WAGMI, "WAGMI");
    }

    function test_lbm() public {
        vm.startPrank(alice);

        IApproveSwapAndPay.SwapParams[] memory swapParams;
        // IApproveSwapAndPay.SwapParams[] memory swapParams = new IApproveSwapAndPay.SwapParams[](1);
        // bytes
        //     memory data = hex"90411a3200000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac39000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000075cb093e4d61d2a2e65d8e0bbb01de8d89b53481000000000000000000000000bb06dca3ae6887fabf931640f67cab3e3a16f4dc00000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000020fa274d00ff4917a13cd464fdbb200475b6eabd00000000000000000000000000000000000000000000000196eef06425065134000000000000000000000000000000000000000000000000000000005937088500000000000000000000000000000000000000000000000000000000b26e110a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000660000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000009e00000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000f8000000000000000000000000000000000000000000000000000000000000010a00000000000000000000000000000000000000000000000000000000000001300000000000000000000000000000000000000000000000000000000000000142000000000000000000000000000000000000000000000000000000000000018c00000000000000000000000000000000000000000000000000000000000001b200000000000000000000000000000000000000000000000000000000000001c400000000000000000000000000000000000000000000000000000000000001d60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001649f86542200000000000000000000000075cb093e4d61d2a2e65d8e0bbb01de8d89b53481000000000000000000000000000000020000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000400000000000000000000000075cb093e4d61d2a2e65d8e0bbb01de8d89b5348100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000242e1a7d4d00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000000000012000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead00000000000000000000000000003d60afecf67e6ba950b499137a72478b2ca7c5a10000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064cac460ee80000000000000003b6d03403d60afecf67e6ba950b499137a72478b2ca7c5a1000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead0000000000000000000000000000732f7a04faba1fccbd36ac22ba9903b2f51f33fb00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000643afe5f00800000000000000002710001732f7a04faba1fccbd36ac22ba9903b2f51f33fb000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001649f86542200000000000000000000000075cb093e4d61d2a2e65d8e0bbb01de8d89b5348100000000000000000000000000000008000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000400000000000000000000000075cb093e4d61d2a2e65d8e0bbb01de8d89b5348100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000242e1a7d4d00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead00000000000000000000000000000000000f000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead00000000000000000000000000005ab390084812e145b619ecaa8671d39174a1a6d100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000643afe5f000000000000000000027100015ab390084812e145b619ecaa8671d39174a1a6d1000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000000000005000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead00000000000000000000000000005ae3ee7fbb3cb28c17e7adc3a6ae605ae24650910000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064cac460ee00000000000000003b6d03405ae3ee7fbb3cb28c17e7adc3a6ae605ae2465091000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead000000000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000003e451a74316000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a2100000000000000000000000000000008000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064eb5625d9000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a21000000000000000000000000248fd66e6ed1e0b325d7b80f5a7e7d8aa2b2528b000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000248fd66e6ed1e0b325d7b80f5a7e7d8aa2b2528b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c49908fc8b000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a21000000000000000000000000bb06dca3ae6887fabf931640f67cab3e3a16f4dc0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000ffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000044000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a210000000000000000000000000000000c0000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a21000000000000000000000000c7c7509d1a192f00c806a0793e5946aae7266d6a00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000643afe5f00800000000000000002710001c7c7509d1a192f00c806a0793e5946aae7266d6a000000000000000000000000ea32a96608495e54156ae48931a7c20f0dcc1a2100000000000000000000000081f30003e1d02901b160dd9c9a4f4209febdac3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000648a6a1e85000000000000000000000000bb06dca3ae6887fabf931640f67cab3e3a16f4dc000000000000000000000000353c1f0bc78fbbc245b3c93ef77b1dcc5b77d2a000000000000000000000000000000000000000000000000000000000b26e110a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a49f865422000000000000000000000000bb06dca3ae6887fabf931640f67cab3e3a16f4dc00000000000000000000000000000001000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000bb06dca3ae6887fabf931640f67cab3e3a16f4dc00000000000000000000000020fa274d00ff4917a13cd464fdbb200475b6eabd00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        // swapParams[0] = IApproveSwapAndPay.SwapParams({
        //     swapTarget: 0x6352a56caadC4F1E25CD6c75970Fa768A3304e64,
        //     maxGasForCall: 0,
        //     swapData: data
        // });

        LiquidityBorrowingManager.RepayParams
            memory AliceRepayingParams = ILiquidityBorrowingManager.RepayParams({
                returnOnlyHoldToken: true,
                isEmergency: false,
                zapInAlgorithm: 0,
                internalSwapPoolfee: 10000,
                externalSwap: swapParams,
                borrowingKey: 0x2d11cb4b77da73cf39de42bd92c3bad7b29f58dfa82098c7b57f7e279f51d1c8,
                minHoldTokenOut: 0,
                minSaleTokenOut: 0
            });

        lbm.repay(AliceRepayingParams, block.timestamp + 1);

        vm.stopPrank();
    }
}
